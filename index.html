<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title id="pageTitle">Premium Vape Shop - Premium Vape Products & Accessories</title>
    <link rel="stylesheet" href="styles.css?v=1.0.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="data-manager.js?v=1.0.0"></script>
    <script src="permanent-storage.js?v=1.0.0"></script>
    <script src="slider-data.js?v=1.0.0"></script>
    <script src="products-data.js?v=1.0.0"></script>
    <script src="embedded-images.js?v=1.0.0"></script>
    <script src="cache-buster.js?v=1.0.0"></script>
</head>
<body class="light-colorful-theme catalog-theme">
    <!-- Top Info Bar -->
    <div class="top-info-bar">
        <div class="container">
            <div class="top-info-content">
                <div class="top-info-left">
                    <span><i class="fas fa-phone"></i> +1 (631) 202-7086</span>
                    <span><i class="fas fa-envelope"></i> support@premiumvapeshop.com</span>
                    <span><i class="fas fa-map-marker-alt"></i> Free Shipping Over $50</span>
                </div>
                <div class="top-info-right">
                    <div id="accountLinks">
                        <a href="login.html"><i class="fas fa-user"></i> Login</a>
                        <span style="margin: 0 8px; color: rgba(255,255,255,0.7)">|</span>
                        <a href="register.html"><i class="fas fa-user-plus"></i> Register</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Header -->
    <header class="main-header">
        <div class="container">
            <div class="header-wrapper">
                <div class="logo-section">
                    <div class="logo-icon">
                        <i class="fas fa-smoking"></i>
                    </div>
                    <div class="logo-text">
                        <h1 class="store-name" id="storeNameHeader">Premium Vape Shop</h1>
                        <p class="store-tagline">Your Premium Vape Destination</p>
                    </div>
                </div>
                
                <div class="search-section">
                    <form class="search-form" onsubmit="handleSearch(event)">
                        <div class="search-wrapper">
                            <input type="text" id="headerSearch" placeholder="Search products, brands..." class="search-input">
                            <button type="submit" class="search-btn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="header-actions">
                    <a href="#" class="cart-button coming-soon-cart" onclick="showComingSoon(event)">
                        <div class="cart-icon-wrapper">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="cart-count" id="cartCount" style="display: none;">0</span>
                        </div>
                        <span class="cart-label">Cart</span>
                        <span class="coming-soon-badge animate-pulse">Coming Soon</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Navigation -->
    <nav class="main-nav-bar">
        <div class="container">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home"></i> Home
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#products" class="nav-link">
                        <i class="fas fa-shopping-bag"></i> Shop
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#brandsGrid" class="nav-link">
                        <i class="fas fa-tags"></i> Brands
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-info-circle"></i> About Us
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#newsletter" class="nav-link">
                        <i class="fas fa-envelope"></i> Contact
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Image Slider Section -->
    <section class="image-slider-section">
        <div class="slider-container">
            <div class="slider-wrapper" id="sliderWrapper">
                <!-- Slides will be loaded here -->
            </div>
            <div class="slider-controls">
                <button class="slider-nav prev" onclick="changeSlide(-1)">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="slider-nav next" onclick="changeSlide(1)">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="slider-indicators" id="sliderDots">
                <!-- Dots will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content-wrapper">
        <div class="container">
            <!-- Catalog Hero & Filters -->
            <section class="catalog-hero">
                <div class="section-header-modern-full catalog-hero-head">
                    <div class="eyebrow-badge"><i class="fas fa-bolt"></i> Live catalog</div>
                    <div>
                        <h2><i class="fas fa-box-open"></i> Curated Wholesale Catalog</h2>
                        <p>Browse products by brand, flavor, or featured picks in a warehouse-style layout that matches our theme.</p>
                    </div>
                </div>

                <div class="catalog-controls">
                    <div class="catalog-search">
                        <i class="fas fa-search"></i>
                        <input type="text" id="catalogSearch" placeholder="Search by name, brand, or flavor" oninput="handleCatalogSearch(event)">
                    </div>
                    <label class="pill-toggle">
                        <input type="checkbox" id="featuredToggle" onchange="handleFeaturedToggle(this.checked)">
                        <span class="toggle-pill"></span>
                        <span class="toggle-label">Featured only</span>
                    </label>
                </div>

                <div class="catalog-brand-row">
                    <button id="allBrandsChip" class="brand-chip active" onclick="clearBrandFilter()" title="Show all brands">
                        <span class="brand-chip-icon"><i class="fas fa-globe"></i></span>
                        <span class="brand-chip-label">All brands</span>
                    </button>
                    <div class="brands-grid-modern" id="brandsGrid">
                        <!-- Brands will be loaded dynamically from localStorage -->
                    </div>
                </div>
            </section>
            
            <!-- Featured Products Section -->
            <section class="content-section-full featured-section-modern">
                <div class="section-header-modern-full">
                    <div>
                        <h2><i class="fas fa-star"></i> Featured Products</h2>
                        <p>Handpicked favorites just for you</p>
                    </div>
                </div>
                <div class="featured-products-modern-full" id="featuredProducts">
                    <!-- Featured products will be loaded here -->
                </div>
            </section>

            <!-- All Products Section -->
            <section class="content-section-full products-section-modern" id="products">
                <div class="section-header-modern-full">
                    <div>
                        <h2><i class="fas fa-box"></i> <span id="productsTitle">All Products</span></h2>
                        <p id="productsSubtitle">Browse our complete collection</p>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button id="clearBrandFilter" onclick="clearBrandFilter()" class="view-btn" style="display: none; background: #ef4444; color: white; border-color: #ef4444;" title="Show All Products">
                            <i class="fas fa-times"></i> Clear Filter
                        </button>
                        <div class="view-controls">
                            <button class="view-btn active" onclick="setViewMode('grid')" id="gridViewBtn" title="Grid View">
                                <i class="fas fa-th"></i>
                            </button>
                            <button class="view-btn" onclick="setViewMode('list')" id="listViewBtn" title="List View">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="products-container-full-screen" id="productsContainer">
                    <div class="products-grid-modern-full" id="productsGrid">
                        <!-- Products will be loaded here -->
                    </div>
                </div>
                <div class="no-products" id="noProducts" style="display: none;">
                    <i class="fas fa-search"></i>
                    <p>No products found.</p>
                </div>
            </section>
        </div>
    </main>

    <!-- Newsletter Section -->
    <section class="newsletter-section-modern">
        <div class="container">
            <div class="newsletter-content-modern">
                <div class="newsletter-text-modern">
                    <h2><i class="fas fa-envelope"></i> Subscribe to Our Newsletter</h2>
                    <p>Get the latest updates, offers, and exclusive deals delivered to your inbox</p>
                </div>
                <form class="newsletter-form-modern" onsubmit="handleNewsletter(event)">
                    <input type="email" placeholder="Enter your email address" required>
                    <button type="submit">Subscribe</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="main-footer-modern">
        <div class="container">
            <div class="footer-content-modern">
                <div class="footer-section-modern">
                    <h3><i class="fas fa-smoking"></i> <span id="footerStoreName">Premium Vape Shop</span></h3>
                    <p>Your trusted destination for premium vape products. Quality you can trust, prices you'll love.</p>
                    <div class="social-links-modern">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-section-modern">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#"><i class="fas fa-home"></i> Home</a></li>
                        <li><a href="#products"><i class="fas fa-box"></i> Products</a></li>
                        <li><a href="cart.html"><i class="fas fa-shopping-cart"></i> Shopping Cart</a></li>
                        <li><a href="login.html"><i class="fas fa-user-shield"></i> Admin Login</a></li>
                    </ul>
                </div>
                <div class="footer-section-modern">
                    <h4>Customer Service</h4>
                    <ul>
                        <li><a href="#"><i class="fas fa-question-circle"></i> FAQ</a></li>
                        <li><a href="#"><i class="fas fa-truck"></i> Shipping Info</a></li>
                        <li><a href="#"><i class="fas fa-undo"></i> Returns</a></li>
                        <li><a href="#"><i class="fas fa-headset"></i> Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-section-modern">
                    <h4>Contact Info</h4>
                    <p><i class="fas fa-map-marker-alt"></i> 1100-4 Portion Road, Farmingville NY 11738</p>
                    <p><i class="fas fa-phone"></i> +1 (631) 202-7086</p>
                    <p><i class="fas fa-envelope"></i> info@premiumvapeshop.com</p>
                </div>
            </div>
            <div class="footer-bottom-modern">
                <p>&copy; 2025 Premium Vape Shop. All rights reserved.</p>
                <div class="footer-links-modern">
                    <a href="#">Privacy Policy</a>
                    <a href="#">Terms of Service</a>
                    <a href="#">Cookie Policy</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scroll to Top Button -->
    <button class="scroll-top-modern" id="scrollTop" onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Site Update Message Box -->
    <div id="siteUpdateMessage" class="site-update-message" style="display: none;">
        <div class="site-update-message-content">
            <div class="site-update-icon">
                <i class="fas fa-sync-alt fa-spin"></i>
            </div>
            <div class="site-update-text">
                <h3>The site is updating</h3>
                <p>Please wait for a few seconds...</p>
            </div>
            <button class="site-update-close" onclick="closeUpdateMessage()" aria-label="Close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="site-update-progress"></div>
    </div>

    <script src="app.js?v=1.0.0"></script>
    <script>
        // Initialize brand filter
        window.currentBrandFilter = null;
        
        // Site Update Message - Show every 2 hours
        function checkAndShowUpdateMessage() {
            const UPDATE_INTERVAL = 2 * 60 * 60 * 1000; // 2 hours in milliseconds
            const DISPLAY_DURATION = 30 * 1000; // 30 seconds in milliseconds
            const STORAGE_KEY = 'lastUpdateMessageTime';
            
            const lastShown = localStorage.getItem(STORAGE_KEY);
            const now = Date.now();
            
            // Check if 2 hours have passed since last message
            if (!lastShown || (now - parseInt(lastShown)) >= UPDATE_INTERVAL) {
                showUpdateMessage();
                // Update the last shown time
                localStorage.setItem(STORAGE_KEY, now.toString());
            }
        }
        
        function showUpdateMessage() {
            const messageBox = document.getElementById('siteUpdateMessage');
            if (!messageBox) return;
            
            // Reset progress bar
            const progressBar = messageBox.querySelector('.site-update-progress');
            if (progressBar) {
                progressBar.style.animation = 'none';
                // Force reflow to reset animation
                void progressBar.offsetWidth;
            }
            
            // Show the message
            messageBox.style.display = 'block';
            
            // Start progress bar animation (30 seconds) after a small delay
            setTimeout(() => {
                if (progressBar) {
                    progressBar.style.animation = 'progressBar 30s linear forwards';
                }
            }, 100);
            
            // Auto-hide after 30 seconds
            setTimeout(() => {
                closeUpdateMessage();
            }, 30000);
        }
        
        function closeUpdateMessage() {
            const messageBox = document.getElementById('siteUpdateMessage');
            if (messageBox) {
                messageBox.style.animation = 'slideOutUp 0.5s ease-out forwards';
                setTimeout(() => {
                    messageBox.style.display = 'none';
                    messageBox.style.animation = '';
                }, 500);
            }
        }
        window.closeUpdateMessage = closeUpdateMessage;
        
        // Helper function to normalize brands (convert old format to new format)
        function normalizeBrandsForIndex(brands) {
            if (!Array.isArray(brands) || brands.length === 0) return [];
            
            // Check if already in new format (array of objects)
            if (typeof brands[0] === 'object' && brands[0] !== null && brands[0].name) {
                return brands;
            }
            
            // Convert old format (array of strings) to new format (array of objects)
            return brands.map((brand, index) => ({
                name: brand,
                displayOrder: index + 1
            }));
        }
        
        // Load brands from localStorage
        function loadBrands() {
            const brandsGrid = document.getElementById('brandsGrid');
            if (!brandsGrid) return;
            
            let brands = JSON.parse(localStorage.getItem('brands') || '[]');
            const brandSubBrands = JSON.parse(localStorage.getItem('brandSubBrands') || '{}');
            
            // Normalize brands structure
            brands = normalizeBrandsForIndex(brands);
            
            // Sort brands by displayOrder (lower number appears first)
            brands.sort((a, b) => {
                const orderA = a.displayOrder || 999;
                const orderB = b.displayOrder || 999;
                return orderA - orderB;
            });
            
            if (brands.length === 0) {
                brandsGrid.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: #6b7280; grid-column: 1 / -1;"><i class="fas fa-tags" style="font-size: 48px; margin-bottom: 20px; opacity: 0.3;"></i><p style="font-size: 18px; margin-bottom: 10px;">No brands available</p><p style="font-size: 14px; opacity: 0.7;">Go to Admin Panel to add brands</p></div>';
                return;
            }
            
            brandsGrid.innerHTML = brands.map(brandObj => {
                const brand = brandObj.name || brandObj;
                const isActive = window.currentBrandFilter === brand;
                return `
                    <button class="brand-chip ${isActive ? 'active' : ''}" onclick="viewBrand('${brand}')" data-brand="${brand}" title="View ${brand}">
                        <span class="brand-chip-icon">${brand.charAt(0).toUpperCase()}</span>
                        <span class="brand-chip-label">${brand}</span>
                        ${isActive ? '<span class="brand-chip-active"><i class="fas fa-check"></i></span>' : ''}
                    </button>
                `;
            }).join('');
        }
        window.loadBrands = loadBrands;
        
        // Brand filter function - filters products on same page
        function viewBrand(brandName) {
            window.currentBrandFilter = brandName;

            if (typeof refreshCatalogProducts === 'function') {
                refreshCatalogProducts();
            } else {
                setTimeout(() => viewBrand(brandName), 120);
                return;
            }
            updateBrandCardsActiveState();
            
            // Scroll to products section smoothly
            const productsSection = document.getElementById('products');
            if (productsSection) {
                setTimeout(() => {
                    productsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }
        }
        
        // Update brand cards to show which one is active
        function updateBrandCardsActiveState() {
            const brandCards = document.querySelectorAll('.brand-chip');
            brandCards.forEach(card => {
                if (card.id === 'allBrandsChip') return;
                const brandName = card.getAttribute('data-brand');
                if (brandName === window.currentBrandFilter) {
                    card.classList.add('active');
                    if (!card.querySelector('.brand-chip-active')) {
                        const badge = document.createElement('span');
                        badge.className = 'brand-chip-active';
                        badge.innerHTML = '<i class="fas fa-check"></i>';
                        card.appendChild(badge);
                    }
                } else {
                    card.classList.remove('active');
                    const badge = card.querySelector('.brand-chip-active');
                    if (badge) badge.remove();
                }
            });
        }
        window.viewBrand = viewBrand;
        
        // Clear brand filter function
        function clearBrandFilter() {
            // Reload all products
            window.currentBrandFilter = null;
            if (typeof refreshCatalogProducts === 'function') {
                refreshCatalogProducts();
            } else if (typeof loadProducts === 'function') {
                loadProducts();
            }
            
            // Reset section title and subtitle
            const productsTitle = document.getElementById('productsTitle');
            const productsSubtitle = document.getElementById('productsSubtitle');
            const clearFilterBtn = document.getElementById('clearBrandFilter');
            
            if (productsTitle) {
                productsTitle.innerHTML = 'All Products';
            }
            if (productsSubtitle) {
                productsSubtitle.textContent = 'Browse our complete collection';
            }
            if (clearFilterBtn) {
                clearFilterBtn.style.display = 'none';
            }
            
            // Update brand cards to remove active state
            updateBrandCardsActiveState();
            
            // Scroll to products section
            const productsSection = document.getElementById('products');
            if (productsSection) {
                productsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        window.clearBrandFilter = clearBrandFilter;
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeHomePage();
            updateCartCount();
            
            // Initialize slider
            if (typeof initSlider !== 'undefined') {
                initSlider();
            }
            
            // Load brands
            loadBrands();
            
            // Load products
            loadProducts();
            
            // Check and show update message (every 2 hours)
            checkAndShowUpdateMessage();
            
            // Initialize featured products
            function initializeFeatured() {
                if (typeof createProductCard !== 'undefined' && typeof getImageSource !== 'undefined') {
                    loadFeaturedProducts();
                } else {
                    setTimeout(initializeFeatured, 100);
                }
            }
            
            setTimeout(initializeFeatured, 300);
            
            setTimeout(() => {
                const container = document.getElementById('featuredProducts');
                if (container && !container.querySelector('.product-card') && 
                    !container.innerHTML.includes('No featured') && 
                    !container.innerHTML.includes('Error')) {
                    loadFeaturedProducts();
                }
            }, 2000);
            
            // Update store name
            const storeName = localStorage.getItem('storeName') || 'Premium Vape Shop';
            document.getElementById('storeNameHeader').textContent = storeName;
            const footerStoreName = document.getElementById('footerStoreName');
            if (footerStoreName) footerStoreName.textContent = storeName;
            
            // Update account links based on login state
            function updateAccountLinks() {
                const container = document.getElementById('accountLinks');
                if (!container) return;
                try {
                    const user = typeof getCurrentUser === 'function' ? getCurrentUser() : null;
                    if (user && user.role === 'admin') {
                        container.innerHTML = `
                            <a href="admin.html"><i class="fas fa-user-shield"></i> Admin Panel</a>
                            <span style="margin: 0 8px; color: rgba(255,255,255,0.7)">|</span>
                            <a href="#" onclick="logoutUser(); return false;"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        `;
                    } else if (user) {
                        container.innerHTML = `
                            <span><i class="fas fa-user"></i> Hi, ${user.username}</span>
                            <span style="margin: 0 8px; color: rgba(255,255,255,0.7)">|</span>
                            <a href="#" onclick="logoutUser(); return false;"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        `;
                    } else {
                        container.innerHTML = `
                            <a href="login.html"><i class="fas fa-user"></i> Login</a>
                            <span style="margin: 0 8px; color: rgba(255,255,255,0.7)">|</span>
                            <a href="register.html"><i class="fas fa-user-plus"></i> Register</a>
                        `;
                    }
                } catch (e) {
                    console.error('Error updating account links:', e);
                }
            }
            updateAccountLinks();
        });
        
        // Listen for storage changes
        window.addEventListener('storage', function(e) {
            if (e.key === 'sliderImages') {
                if (typeof initSlider !== 'undefined') {
                    initSlider();
                }
            }
            if (e.key === 'featuredProducts' || e.key === 'products') {
                setTimeout(loadFeaturedProducts, 100);
            }
            if (e.key === 'brands' || e.key === 'brandSubBrands') {
                loadBrands();
            }
        });
        
        // Featured Products
        function loadFeaturedProducts() {
            const featuredContainer = document.getElementById('featuredProducts');
            if (!featuredContainer) return;
            
            if (typeof createProductCard === 'undefined' || typeof getImageSource === 'undefined') {
                setTimeout(loadFeaturedProducts, 100);
                return;
            }
            
            try {
                const products = JSON.parse(localStorage.getItem('products') || '[]');
                const featuredProductIds = JSON.parse(localStorage.getItem('featuredProducts') || '[]');
                
                const featured = [];
                for (let i = 0; i < featuredProductIds.length && featured.length < 4; i++) {
                    const id = featuredProductIds[i];
                    if (id && String(id).trim() !== '') {
                        const product = products.find(p => String(p.id) === String(id));
                        if (product) {
                            featured.push(product);
                        }
                    }
                }
                
                if (featured.length > 0) {
                    featuredContainer.innerHTML = featured.map(product => createProductCard(product)).join('');
                } else if (products.length > 0) {
                    const fallback = products.slice(0, 4);
                    featuredContainer.innerHTML = fallback.map(product => createProductCard(product)).join('');
                } else {
                    featuredContainer.innerHTML = `
                        <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
                            <i class="fas fa-star" style="font-size: 48px; margin-bottom: 20px; opacity: 0.3;"></i>
                            <p style="font-size: 18px; margin-bottom: 10px;">No featured products yet</p>
                            <p style="font-size: 14px; opacity: 0.7;">Go to Admin Panel to set featured products</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading featured products:', error);
                featuredContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ef4444;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 32px; margin-bottom: 15px;"></i>
                        <p>Error loading featured products. Please refresh the page.</p>
                    </div>
                `;
            }
        }
        
        window.loadFeaturedProducts = loadFeaturedProducts;
        
        
        // Keep dropdown open when hovering over it
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const dropdowns = document.querySelectorAll('.sub-brands-dropdown');
                dropdowns.forEach(dropdown => {
                    dropdown.addEventListener('mouseenter', function(e) {
                        e.stopPropagation();
                        this.style.opacity = '1';
                        this.style.transform = 'translateY(0)';
                    });
                    dropdown.addEventListener('mouseleave', function(e) {
                        e.stopPropagation();
                        const card = this.closest('.brand-card-modern');
                        if (card) {
                            hideSubBrands(card);
                        }
                    });
                });
            }, 100);
        });

        function handleSearch(event) {
            event.preventDefault();
            const query = document.getElementById('headerSearch').value;
            const catalogSearch = document.getElementById('catalogSearch');
            if (catalogSearch) {
                catalogSearch.value = query;
            }
            if (typeof refreshCatalogProducts === 'function') {
                refreshCatalogProducts();
            } else {
                const products = JSON.parse(localStorage.getItem('products') || '[]');
                const filtered = products.filter(p => 
                    p.name.toLowerCase().includes(query.toLowerCase()) ||
                    p.brand.toLowerCase().includes(query.toLowerCase()) ||
                    p.flavor.toLowerCase().includes(query.toLowerCase())
                );
                displayFilteredProducts(filtered);
            }
            document.getElementById('products').scrollIntoView({ behavior: 'smooth' });
        }

        function handleNewsletter(event) {
            event.preventDefault();
            alert('Thank you for subscribing! You will receive our latest updates.');
            event.target.reset();
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Show scroll to top button
        window.addEventListener('scroll', function() {
            const scrollTop = document.getElementById('scrollTop');
            if (window.scrollY > 300) {
                scrollTop.style.display = 'flex';
            } else {
                scrollTop.style.display = 'none';
            }
        });

        // View Mode Toggle (Grid/List)
        let currentViewMode = localStorage.getItem('productViewMode') || 'grid';
        
        function setViewMode(mode) {
            currentViewMode = mode;
            localStorage.setItem('productViewMode', mode);
            
            const productsGrid = document.getElementById('productsGrid');
            const gridBtn = document.getElementById('gridViewBtn');
            const listBtn = document.getElementById('listViewBtn');
            
            if (!productsGrid) return;
            
            if (mode === 'grid') {
                productsGrid.classList.remove('list-view');
                productsGrid.classList.add('grid-view');
                if (gridBtn) gridBtn.classList.add('active');
                if (listBtn) listBtn.classList.remove('active');
            } else {
                productsGrid.classList.remove('grid-view');
                productsGrid.classList.add('list-view');
                if (listBtn) listBtn.classList.add('active');
                if (gridBtn) gridBtn.classList.remove('active');
            }
        }
        
        window.setViewMode = setViewMode;
        
        // Initialize view mode on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                setViewMode(currentViewMode);
            }, 100);
        });
        
        // Show coming soon message for cart
        function showComingSoon(event) {
            event.preventDefault();
            alert('Shopping Cart feature is coming soon! Stay tuned for updates.');
        }
        window.showComingSoon = showComingSoon;
    </script>
</body>
</html>

